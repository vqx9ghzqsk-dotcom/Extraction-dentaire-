<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âtude Extraction Dentaire - Makala</title>
    <style>
        :root {
            --color-primary: #a03355; /* Le bordeaux de l'image */
            --color-secondary: #f8f9fa;
            --color-border: #dee2e6;
            --color-orange: #f0ad4e;
            --color-green: #3e7e40;
            --text-dark: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 20px;
            color: var(--text-dark);
        }

        /* --- Navigation Style (Comme sur la photo) --- */
        .nav-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-item {
            background: white;
            border: 1px solid var(--color-border);
            padding: 15px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
            flex: 1;
            text-align: center;
            transition: all 0.2s;
            color: #666;
            min-width: 150px;
        }

        .nav-item.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .nav-item:hover:not(.active) {
            background-color: #e9ecef;
        }

        .data-badge {
            background-color: var(--color-orange);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .btn-export {
            background-color: var(--color-green);
            color: white;
            padding: 15px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .btn-export:hover {
            opacity: 0.9;
        }

        /* --- Content Sections --- */
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-top: 4px solid var(--color-primary);
        }

        .tab-content.active {
            display: block;
        }

        /* --- Form Styles --- */
        .form-section {
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .form-section h3 { color: var(--color-primary); margin-top: 0; }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .btn-submit {
            background-color: var(--color-primary);
            color: white;
            padding: 10px 30px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
        }

        /* --- Table Styles --- */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f8f9fa; color: var(--color-primary); }
        tr:nth-child(even) { background-color: #f9f9f9; }

        /* --- Analysis Dashboard Styles --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .stat-card h4 { margin: 0 0 10px 0; color: #555; font-size: 0.9rem; text-transform: uppercase; }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: var(--color-primary); }
        
        .analysis-section { margin-top: 30px; }
        .analysis-section h3 { background: #eee; padding: 10px; border-left: 5px solid var(--color-primary); }
        
        .bar-chart-container { margin-top: 10px; }
        .bar-row { display: flex; align-items: center; margin-bottom: 8px; font-size: 0.85rem; }
        .bar-label { width: 120px; text-align: right; padding-right: 10px; }
        .bar-bg { flex-grow: 1; background: #eee; height: 20px; border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--color-primary); display: flex; align-items: center; padding-left: 5px; color: white; font-size: 0.75rem; white-space: nowrap; }

        .cross-tab-table th { background-color: #444; color: white; font-size: 0.8rem; }
        .cross-tab-table td { text-align: center; }

        .methodology-box {
            background-color: #e8f4fd;
            border: 1px solid #b6d4fe;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div class="nav-container">
        <div class="nav-item active" onclick="switchTab(1)">1. Collecte<br><span id="nav-count">0</span> Dossiers</div>
        <div class="nav-item" onclick="switchTab(2)">2. Matrice de<br>D√©pouillement</div>
        <div class="nav-item" onclick="switchTab(3)">3. R√©sultats &<br>Analyse Protocole</div>
        <div class="nav-item" onclick="switchTab(4)">4. Conclusion &<br>Recommandations</div>
        
        <div class="data-badge">
            DONN√âES:<br>KINSHASA (N=<span id="total-n">0</span>)
        </div>
        
        <button class="btn-export" onclick="alert('Export CSV simul√© !')">
            üíæ EXPORT CSV
        </button>
    </div>

    <div id="tab-1" class="tab-content active">
        <h2>Saisie des Donn√©es (Fiche Makala)</h2>
        <form id="dataForm">
            <div class="form-section">
                <h3>I. Identification</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Num√©ro ID</label>
                        <input type="text" id="id_dossier" required placeholder="Ex: 001">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="date_consult" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>II. Sociod√©mographie</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>√Çge (ans)</label>
                        <input type="number" id="age" min="1" max="100" required>
                    </div>
                    <div class="form-group">
                        <label>Sexe</label>
                        <select id="sexe" required>
                            <option value="M">Masculin</option>
                            <option value="F">F√©minin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Profession</label>
                        <input type="text" id="profession">
                    </div>
                    <div class="form-group">
                        <label>R√©sidence</label>
                        <input type="text" id="residence">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>III. & IV. Clinique & Indication</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Motif Consult.</label>
                        <input type="text" id="motif" placeholder="Douleur...">
                    </div>
                    <div class="form-group">
                        <label>Dent Concern√©e</label>
                        <input type="text" id="dent" placeholder="Ex: 36">
                    </div>
                    <div class="form-group">
                        <label>Arcade</label>
                        <select id="arcade">
                            <option value="Maxillaire">Maxillaire</option>
                            <option value="Mandibulaire">Mandibulaire</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Indication (Code)</label>
                        <select id="indication" required>
                            <option value="1">1. Carie avanc√©e</option>
                            <option value="2">2. Compl. Pulpo-p√©riapicale</option>
                            <option value="3">3. Maladie parodontale</option>
                            <option value="4">4. Dent incluse</option>
                            <option value="5">5. Traumatisme</option>
                            <option value="6">6. Orthodontique</option>
                            <option value="7">7. Autres</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>V - VII. Examen & Acte</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Radiographie ?</label>
                        <select id="radio">
                            <option value="0">Non</option>
                            <option value="1">Oui</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Type Extraction</label>
                        <select id="type_ext">
                            <option value="Simple">Simple</option>
                            <option value="Chirurgicale">Chirurgicale</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Complication</label>
                        <select id="complication">
                            <option value="Aucune">Aucune</option>
                            <option value="H√©morragie">H√©morragie</option>
                            <option value="Infection">Infection</option>
                            <option value="Alv√©olite">Alv√©olite</option>
                            <option value="Autres">Autres</option>
                        </select>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn-submit">Ajouter le patient</button>
            <button type="button" class="btn-submit" style="background:#666;" onclick="generateDummyData()">G√©n√©rer donn√©es test (Auto)</button>
        </form>
    </div>

    <div id="tab-2" class="tab-content">
        <h2>Matrice de D√©pouillement</h2>
        <p>Vue brute des donn√©es saisies.</p>
        <div style="overflow-x: auto;">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Age</th>
                        <th>Sexe</th>
                        <th>Dent</th>
                        <th>Arcade</th>
                        <th>Indication</th>
                        <th>Type Ext.</th>
                        <th>Compl.</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>

    <div id="tab-3" class="tab-content">
        <h2>Tableau de Bord Analytique</h2>
        
        <div class="methodology-box">
            <strong>üìä M√©thodologie activ√©e :</strong><br>
            Cette section r√©alise automatiquement une <em>√âtude r√©trospective descriptive et analytique</em>.<br>
            <ul>
                <li><strong>Variables :</strong> Sexe, Indication, Complication (Qualitatives) / √Çge (Quantitative).</li>
                <li><strong>Tests simul√©s :</strong> Chi-carr√© (pour les croisements) et T-student (comparaison moyennes).</li>
            </ul>
        </div>

        <div class="analysis-section">
            <h3>A. Statistiques Descriptives (Globales)</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Population Totale</h4>
                    <div class="stat-value" id="res-total">0</div>
                    <small>Dossiers trait√©s</small>
                </div>
                <div class="stat-card">
                    <h4>√Çge Moyen</h4>
                    <div class="stat-value" id="res-age-mean">0 ans</div>
                    <small>Min: <span id="res-age-min">-</span> / Max: <span id="res-age-max">-</span></small>
                </div>
                <div class="stat-card">
                    <h4>Sex Ratio (H/F)</h4>
                    <div class="stat-value" id="res-sex-ratio">-</div>
                    <small id="res-sex-detail">0 M / 0 F</small>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Pr√©valence des Indications</h4>
                    <div id="chart-indications"></div>
                </div>
                <div class="stat-card">
                    <h4>Type d'Extraction</h4>
                    <div id="chart-type-ext"></div>
                </div>
            </div>
        </div>

        <div class="analysis-section">
            <h3>B. Croisements de Variables (Analytique)</h3>
            
            <div class="stats-grid">
                <div class="stat-card" style="grid-column: span 2;">
                    <h4>1. √Çge Moyen par Indication (Association)</h4>
                    <p style="font-size:0.8rem; color:#666;">Permet de voir si certaines pathologies touchent les plus vieux.</p>
                    <table class="cross-tab-table">
                        <thead>
                            <tr>
                                <th>Indication</th>
                                <th>Nombre de cas</th>
                                <th>√Çge Moyen</th>
                            </tr>
                        </thead>
                        <tbody id="table-age-indic"></tbody>
                    </table>
                </div>

                <div class="stat-card">
                    <h4>2. Sexe √ó Indication</h4>
                    <p style="font-size:0.8rem; color:#666;">Qui est le plus touch√© ?</p>
                    <table class="cross-tab-table">
                        <thead>
                            <tr>
                                <th>Indication</th>
                                <th>Hommes</th>
                                <th>Femmes</th>
                            </tr>
                        </thead>
                        <tbody id="table-sex-indic"></tbody>
                    </table>
                </div>

                <div class="stat-card">
                    <h4>3. Indication √ó Type Extraction</h4>
                    <p style="font-size:0.8rem; color:#666;">Logique clinique respect√©e ?</p>
                    <table class="cross-tab-table">
                        <thead>
                            <tr>
                                <th>Indication</th>
                                <th>Simple</th>
                                <th>Chirurgicale</th>
                            </tr>
                        </thead>
                        <tbody id="table-indic-type"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-4" class="tab-content">
        <h2>Conclusion & Recommandations</h2>
        <div style="background:#fff; padding:20px; border:1px solid #ddd;">
            <p>Sur la base des donn√©es analys√©es (N=<span id="concl-n">0</span>), nous observons que :</p>
            <ul>
                <li>L'indication principale est : <strong id="concl-main-indic">...</strong>.</li>
                <li>La population est majoritairement de sexe <strong id="concl-sex">...</strong> avec une moyenne d'√¢ge de <strong id="concl-age">...</strong> ans.</li>
                <li>Les extractions chirurgicales repr√©sentent <strong id="concl-chir-perc">...</strong>% des actes.</li>
            </ul>
            <p><strong>Recommandation :</strong> Renforcer la pr√©vention sur l'hygi√®ne bucco-dentaire pour r√©duire la pr√©valence de la carie, principale cause de perte dentaire.</p>
        </div>
    </div>

    <script>
        // --- 1. Gestion des Donn√©es ---
        let database = [];

        // Dictionnaire pour les codes indications
        const indicLabels = {
            "1": "Carie avanc√©e",
            "2": "Compl. Pulpo-p√©ri.",
            "3": "Maladie parodontale",
            "4": "Dent incluse",
            "5": "Traumatisme",
            "6": "Orthodontique",
            "7": "Autres"
        };

        // --- 2. Fonctions d'Interface ---
        function switchTab(tabIndex) {
            // Cacher tous les contenus
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            // Afficher le bon
            document.getElementById(`tab-${tabIndex}`).classList.add('active');
            
            // Mettre √† jour la nav
            const navItems = document.querySelectorAll('.nav-item');
            if(navItems[tabIndex-1]) navItems[tabIndex-1].classList.add('active');

            // Si on va sur l'onglet 2 ou 3, on rafraichit les donn√©es
            if (tabIndex === 2) renderTable();
            if (tabIndex === 3 || tabIndex === 4) calculateStats();
        }

        // --- 3. Ajout de Donn√©es ---
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newRecord = {
                id: document.getElementById('id_dossier').value,
                date: document.getElementById('date_consult').value,
                age: parseInt(document.getElementById('age').value),
                sex: document.getElementById('sexe').value,
                motif: document.getElementById('motif').value,
                dent: document.getElementById('dent').value,
                arcade: document.getElementById('arcade').value,
                indic: document.getElementById('indication').value,
                typeExt: document.getElementById('type_ext').value,
                comp: document.getElementById('complication').value
            };

            database.push(newRecord);
            updateGlobalCounters();
            alert("Patient ajout√© avec succ√®s !");
            this.reset();
        });

        function updateGlobalCounters() {
            const count = database.length;
            document.getElementById('nav-count').innerText = count;
            document.getElementById('total-n').innerText = count;
        }

        // --- 4. Rendu Tableau (Matrice) ---
        function renderTable() {
            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';
            
            database.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.id}</td>
                    <td>${row.age}</td>
                    <td>${row.sex}</td>
                    <td>${row.dent}</td>
                    <td>${row.arcade}</td>
                    <td>${indicLabels[row.indic]}</td>
                    <td>${row.typeExt}</td>
                    <td>${row.comp}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- 5. ANALYSE STATISTIQUE (Le c≈ìur du script) ---
        function calculateStats() {
            if (database.length === 0) return;

            // A. Stats Globales
            const total = database.length;
            document.getElementById('res-total').innerText = total;

            // Age
            const totalAge = database.reduce((acc, curr) => acc + curr.age, 0);
            const ages = database.map(d => d.age);
            document.getElementById('res-age-mean').innerText = (totalAge / total).toFixed(1) + " ans";
            document.getElementById('res-age-min').innerText = Math.min(...ages);
            document.getElementById('res-age-max').innerText = Math.max(...ages);

            // Sexe
            const mCount = database.filter(d => d.sex === 'M').length;
            const fCount = database.filter(d => d.sex === 'F').length;
            document.getElementById('res-sex-ratio').innerText = fCount > 0 ? (mCount / fCount).toFixed(2) : mCount;
            document.getElementById('res-sex-detail').innerText = `${mCount} H (${Math.round(mCount/total*100)}%) / ${fCount} F (${Math.round(fCount/total*100)}%)`;

            // B. Graphiques (Frequences)
            generateBarChart('chart-indications', getFreqByKey('indic', true));
            generateBarChart('chart-type-ext', getFreqByKey('typeExt', false));

            // C. CROISEMENTS (Logique complexe)
            
            // 1. Age moyen par Indication
            let ageIndicHTML = '';
            for (let code in indicLabels) {
                const subset = database.filter(d => d.indic === code);
                if (subset.length > 0) {
                    const avgAge = (subset.reduce((a,b) => a + b.age, 0) / subset.length).toFixed(1);
                    ageIndicHTML += `<tr><td>${indicLabels[code]}</td><td>${subset.length}</td><td>${avgAge} ans</td></tr>`;
                }
            }
            document.getElementById('table-age-indic').innerHTML = ageIndicHTML;

            // 2. Sexe x Indication
            let sexIndicHTML = '';
            for (let code in indicLabels) {
                const subsetM = database.filter(d => d.indic === code && d.sex === 'M').length;
                const subsetF = database.filter(d => d.indic === code && d.sex === 'F').length;
                if (subsetM + subsetF > 0) {
                    sexIndicHTML += `<tr><td>${indicLabels[code]}</td><td>${subsetM}</td><td>${subsetF}</td></tr>`;
                }
            }
            document.getElementById('table-sex-indic').innerHTML = sexIndicHTML;

            // 3. Indication x Type Extraction
            let indicTypeHTML = '';
            for (let code in indicLabels) {
                const subsetSimple = database.filter(d => d.indic === code && d.typeExt === 'Simple').length;
                const subsetChir = database.filter(d => d.indic === code && d.typeExt === 'Chirurgicale').length;
                if (subsetSimple + subsetChir > 0) {
                    indicTypeHTML += `<tr><td>${indicLabels[code]}</td><td>${subsetSimple}</td><td>${subsetChir}</td></tr>`;
                }
            }
            document.getElementById('table-indic-type').innerHTML = indicTypeHTML;

            // Mise √† jour Conclusion
            updateConclusion(total, totalAge, mCount, fCount);
        }

        // Helpers
        function getFreqByKey(key, useLabelMap) {
            const counts = {};
            database.forEach(d => {
                const val = useLabelMap ? indicLabels[d[key]] : d[key];
                counts[val] = (counts[val] || 0) + 1;
            });
            return counts;
        }

        function generateBarChart(elementId, dataObj) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            const total = database.length;
            
            // Trier par fr√©quence d√©croissante
            const sortedKeys = Object.keys(dataObj).sort((a,b) => dataObj[b] - dataObj[a]);

            sortedKeys.forEach(key => {
                const count = dataObj[key];
                const perc = Math.round((count / total) * 100);
                
                const row = document.createElement('div');
                row.className = 'bar-row';
                row.innerHTML = `
                    <div class="bar-label">${key}</div>
                    <div class="bar-bg">
                        <div class="bar-fill" style="width: ${perc}%">${count} (${perc}%)</div>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function updateConclusion(total, totalAge, mCount, fCount) {
             document.getElementById('concl-n').innerText = total;
             document.getElementById('concl-age').innerText = (totalAge/total).toFixed(1);
             document.getElementById('concl-sex').innerText = mCount > fCount ? "Masculin" : "F√©minin";
             
             // Trouver indication majoritaire
             const counts = getFreqByKey('indic', true);
             const mainIndic = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
             document.getElementById('concl-main-indic').innerText = mainIndic;

             // Taux chirurgical
             const chirCount = database.filter(d => d.typeExt === 'Chirurgicale').length;
             document.getElementById('concl-chir-perc').innerText = ((chirCount/total)*100).toFixed(1);
        }

        // --- FONCTION BONUS : G√âN√âRER DES DONN√âES TEST ---
        function generateDummyData() {
            const indics = ["1", "1", "1", "2", "3", "3", "4", "4", "5", "7"]; // Pond√©r√© pour carie (1)
            const types = ["Simple", "Simple", "Simple", "Chirurgicale"];
            
            for(let i=0; i<10; i++) {
                const rndIndic = indics[Math.floor(Math.random() * indics.length)];
                // Logique: si dent incluse (4), souvent chirurgicale
                let rndType = types[Math.floor(Math.random() * types.length)];
                if(rndIndic === "4") rndType = "Chirurgicale";

                database.push({
                    id: (database.length + 1).toString().padStart(3, '0'),
                    date: "2023-10-01",
                    age: Math.floor(Math.random() * 60) + 10,
                    sex: Math.random() > 0.5 ? "M" : "F",
                    motif: "Douleur",
                    dent: Math.floor(Math.random() * 30) + 10,
                    arcade: Math.random() > 0.5 ? "Maxillaire" : "Mandibulaire",
                    indic: rndIndic,
                    typeExt: rndType,
                    comp: Math.random() > 0.9 ? "Alv√©olite" : "Aucune"
                });
            }
            updateGlobalCounters();
            alert("10 patients fictifs ajout√©s ! Allez voir l'onglet R√©sultats.");
            switchTab(3); // Aller direct aux r√©sultats pour voir l'effet
        }

        // Init
        updateGlobalCounters();
    </script>
</body>
</html>
